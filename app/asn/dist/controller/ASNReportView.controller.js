sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/export/Spreadsheet","sap/ui/export/library","sap/m/MessageBox"],function(e,t,a,r){"use strict";return e.extend("sap.fiori.asn.controller.ASNReportView",{onInit:function(){this.router=sap.ui.core.UIComponent.getRouterFor(this);this.DataModel=new sap.ui.model.json.JSONModel;this.DataModel.setSizeLimit(1e7);this.getView().setModel(this.DataModel,"DataModel");this.detailModel=sap.ui.getCore().getModel("detailModel");this.loginModel=sap.ui.getCore().getModel("loginModel");this.getView().setModel(this.loginModel,"loginModel");this.localModel=new sap.ui.model.json.JSONModel;this.getView().setModel(this.localModel,"localModel");this._tableTemp=this.getView().byId("tableTempId").clone();this.oDataModel=sap.ui.getCore().getModel("oDataModel");this.getView().setModel(this.oDataModel);sap.ui.core.BusyIndicator.show();var e=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyyMMdd"});var t=sap.ui.core.format.DateFormat.getDateInstance({pattern:"ddMMMyyyy"});this.curDate=new Date;this.startDate=new Date(this.curDate.getTime()-30*24*3600*1e3);this.getView().byId("endDateId").setMinDate(this.startDate);this.curDate=e.format(this.curDate);this.startDate=e.format(this.startDate);this.getView().byId("endDateId").setValue(this.curDate);this.getView().byId("startDateId").setValue(this.startDate);this.ASNtodate=new Date;this.ASNfromdate=new Date(this.ASNtodate.getTime()-30*24*3600*1e3);this.ASNtodate=t.format(this.ASNtodate);this.ASNfromdate=t.format(this.ASNfromdate);this.ASNtodate=this.ASNtodate.substring(0,2)+" "+this.ASNtodate.substring(2,5)+" "+this.ASNtodate.substring(5,9);this.ASNfromdate=this.ASNfromdate.substring(0,2)+" "+this.ASNfromdate.substring(2,5)+" "+this.ASNfromdate.substring(5,9);var a=this;this.AddressCode=sessionStorage.getItem("AddressCode")||"JSE-01-01";this.getView().byId("vendorCodeId").setValue(this.AddressCode);this.LoggedUser=sessionStorage.getItem("LoggedUser")||"rajeshsehgal@impauto.com";var s=this.getOwnerComponent().getModel();s.read("/GetASNHeaderList",{urlParameters:{username:this.LoggedUser,AddressCode:this.AddressCode,PoNumber:"",ASNNumber:"",ASNFromdate:this.ASNfromdate,ASNTodate:this.ASNtodate,InvoiceStatus:"",MRNStatus:"",ApprovedBy:""},success:function(e){sap.ui.core.BusyIndicator.hide();a.DataModel.setData(e);a.DataModel.refresh()},error:function(e){sap.ui.core.BusyIndicator.hide();var t=JSON.parse(e.response.body);r.error(t.error.message.value)}});var o=this.getView().byId("startDateId");o.addDelegate({onAfterRendering:function(){o.$().find("INPUT").attr("disabled",true).css("color","#000000")}},o);o=this.getView().byId("endDateId");o.addDelegate({onAfterRendering:function(){o.$().find("INPUT").attr("disabled",true).css("color","#000000")}},o)},onFilterClear:function(){var e=this.localModel.getData();e.ASNNumber="";e.PONumber="";e.CreateStartDate="";e.CreateEndDate="";e.InvoiceStatus="";e.GRNStatus="";this.localModel.refresh(true);var t=this.getView();t.byId("asnnumId").setValue("");t.byId("ponumId").setValue("");t.byId("createstartDateId").setValue("");t.byId("createendDateId").setValue("");t.byId("invoicestatusid").setSelectedKey("");t.byId("grnstatusid").setSelectedKey("")},onFilterGoPress:function(){sap.ui.core.BusyIndicator.show();var e=this;var t=this.localModel.getData();var a=this.getOwnerComponent().getModel();var s=sap.ui.core.format.DateFormat.getDateInstance({pattern:"ddMMMyyyy"});this.EndDate=this.getView().byId("endDateId").getDateValue();this.StartDate=this.getView().byId("startDateId").getDateValue();this.EndDate=s.format(this.EndDate);this.StartDate=s.format(this.StartDate);this.EndDate=this.EndDate.substring(0,2)+" "+this.EndDate.substring(2,5)+" "+this.EndDate.substring(5,9);this.StartDate=this.StartDate.substring(0,2)+" "+this.StartDate.substring(2,5)+" "+this.StartDate.substring(5,9);if(!t.ASNNumber){t.ASNNumber=""}if(!t.PONumber){t.PONumber=""}if(!t.VendorCode){this.VendorCode=this.AddressCode}else if(t.VendorCode){this.VendorCode=t.VendorCode}if(!t.CreatedBy){t.CreatedBy=""}if(!t.InvoiceStatus){t.InvoiceStatus=""}if(!t.GRNStatus){t.GRNStatus=""}a.read("/GetASNHeaderList",{urlParameters:{username:this.LoggedUser,AddressCode:this.VendorCode,PoNumber:t.PONumber,ASNNumber:t.ASNNumber,ASNFromdate:this.StartDate,ASNTodate:this.EndDate,InvoiceStatus:t.InvoiceStatus,MRNStatus:t.GRNStatus,ApprovedBy:t.CreatedBy},success:function(t){sap.ui.core.BusyIndicator.hide();e.DataModel.setData(t);e.DataModel.refresh()},error:function(e){sap.ui.core.BusyIndicator.hide();var t=JSON.parse(e.response.body);r.error(t.error.message.value)}})},onItempress:function(e){var t=this.localModel.getData();var a=e.getParameter("listItem").getBindingContext("DataModel").getProperty();this.AsnNumber=a.ASNNumber.replace(/\//g,"-");this.router.navTo("ASNReportDetail",{AsnNumber:this.AsnNumber,AddressCode:t.VendorCode,UnitCode:a.PlantCode})},onColumnSelection:function(e){var t=this;var a=t.byId("List");var r=this.byId("popOver");if(a!==undefined){a.destroy()}if(r!==undefined){r.destroy()}var s=new sap.m.Popover(this.createId("popOver"),{showHeader:true,placement:sap.m.PlacementType.Bottom,content:[]}).addStyleClass("sapMOTAPopover sapTntToolHeaderPopover sapUiResponsivePadding--header sapUiResponsivePadding--footer");var o=new sap.m.List(this.createId("List"),{});this.byId("popOver").addContent(o);var i=this.getView().byId("TableDataId"),d=i.getColumns();var n=[];for(var l=0;l<d.length;l++){var u=d[l].getAggregation("header").getProperty("text");var h={};h.column=u;n.push(h)}var g=new sap.ui.model.json.JSONModel({list:n});var p=new sap.m.StandardListItem({title:"{oList>column}"});o.setMode("MultiSelect");o.setModel(g);sap.ui.getCore().setModel(g,"oList");var c={path:"oList>/list",template:p};o.bindItems(c);var m=new sap.m.Bar({contentLeft:[],contentMiddle:[new sap.m.Button({text:"Cancel",press:function(){t.onCancel()}})],contentRight:[new sap.m.Button({text:"Save",press:function(){t.onSave()}})]});this.byId("popOver").setFooter(m);var y=this.byId("List");var b=this.byId("TableDataId").getColumns();y.attachEventOnce("updateFinished",function(){var e=[];for(var t=0;t<b.length;t++){var a=y.oModels.undefined.oData.list[t].column;e.push(a);var r=b[t].getHeader().getProperty("text");var s=b[t].getProperty("visible");if(s===true){if(e.indexOf(r)>-1){var o=y.getItems()[t];y.setSelectedItem(o,true)}}}});s.openBy(e.getSource())},onCancel:function(){this.byId("popOver").close()},onSave:function(){var e=this;var t=this.byId("List");var a=[];var r=t.getSelectedItems();for(var s=0;s<r.length;s++){var o=r[s];var i=o.getBindingContext("oList");var d=i.getProperty(null,i);var n=d.column;a.push(n)}var l=this.byId("TableDataId").getColumns();for(var u=0;u<l.length;u++){var h=l[u].getHeader().getProperty("text");var g=l[u].getId();var p=this.getView().byId(g);if(a.indexOf(h)>-1){p.setVisible(true)}else{p.setVisible(false)}}this.byId("popOver").close()},onFromDateChange:function(e){var t=this.getView().byId("startDateId").getDateValue();var a=this.getView().byId("endDateId").getDateValue();this.getView().byId("endDateId").setMinDate(t);if(a<=t){this.getView().byId("endDateId").setDateValue(new Date(t))}e.getSource().$().find("INPUT").attr("disabled",true).css("color","#000000")},onCreateFromDateChange:function(e){var t=this.getView().byId("createstartDateId").getDateValue();var a=this.getView().byId("createendDateId").getDateValue();this.getView().byId("createendDateId").setMinDate(t);if(a<=t){this.getView().byId("createendDateId").setDateValue(new Date(t))}e.getSource().$().find("INPUT").attr("disabled",true).css("color","#000000")},onDataExport:function(){var e,a,r=[];var s=this.DataModel.getData().results;if(s){a=this.getView().byId("TableDataId").getColumns();r=[{label:"ASN Number",property:"ASNNumber",type:"string"},{label:"ASN Date/Time",property:"ASNDateTime",type:"string"},{label:"PO Number",property:"PoNumber",type:"string"},{label:"Schedule Number",property:"ScheduleNumber",type:"string"},{label:"Gate Entry Status",property:"GateEntryStatus",type:"string"},{label:"GRN Status",property:"GRNStatus",type:"string"},{label:"Invoice Status",property:"InvoiceStatus",type:"string"},{label:"Plant Code",property:"PlantCode",type:"string"},{label:"Plant Name",property:"PlantName",type:"string"},{label:"Vendor Code",property:"VendorCode",type:"string"},{label:"Vendor Name",property:"VendorName",type:"string"},{label:"Material",property:"MaterialCode",type:"string"},{label:"Material Desription",property:"MaterialDescription",type:"string"}];e={workbook:{columns:r},dataSource:s,fileName:"ASN Report"};new t(e).build()}}})});